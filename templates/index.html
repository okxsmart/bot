<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Groq Voice Bot ‚Äî –ê—Å–∏—Å—Ç–µ–Ω—Ç</title>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=FmSmJQPV"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      margin: 20px;
    }
    h1 {
      color: #0f0;
      margin-bottom: 10px;
    }
    #chat-box {
      background: #222;
      border: 1px solid #444;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }
    .message {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 6px;
      max-width: 80%;
    }
    .user {
      background: #0a84ff22;
      color: #aaf;
      align-self: flex-end;
      margin-left: auto;
    }
    .bot {
      background: #28a74533;
      color: #8f8;
      align-self: flex-start;
      margin-right: auto;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 8px;
    }
    select, textarea, button {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      padding: 6px;
      font-size: 1rem;
      border-radius: 4px;
    }
    select {
      min-width: 180px;
    }
    textarea {
      width: 100%;
      resize: vertical;
      min-height: 70px;
    }
    button {
      cursor: pointer;
      min-width: 120px;
    }
    #status {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 6px;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <h1>ü§ñ Groq Voice Bot ‚Äî –ê—Å–∏—Å—Ç–µ–Ω—Ç</h1>
	<div id="controls">
	  <label for="language">–ú–æ–≤–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</label>
	  <select id="language" title="–ú–æ–≤–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è">
		<option value="uk-UA" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ üá∫üá¶</option>
		<option value="ru-RU">–†–æ—Å—ñ–π—Å—å–∫–∞ üá∑üá∫</option>
		<option value="en-US">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ üá¨üáß</option>
	  </select>

	  <label for="model">–ú–æ–¥–µ–ª—å LLM:</label>
	  <select id="model" title="–í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ">
		<option value="llama3-70b-8192" selected>LLaMA 3 (70B)</option>
		<option value="llama3-8b-8192">LLaMA 3 (8B)</option>
		<option value="meta-llama/llama-4-maverick-17b-128e-instruct">LLaMA 4 Maverick (17B)</option>
		<option value="deepseek-r1-distill-llama-70b">DeepSeek Distill 70B</option>
		<option value="gemma2-9b-it">Gemma 2 (9B IT)</option>
	  </select>

	  <!-- –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤–∏–±—ñ—Ä –≥–æ–ª–æ—Å—É, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –º–æ–≤–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è -->
	  <label for="voice" style="display:none;">–ì–æ–ª–æ—Å –æ–∑–≤—É—á–µ–Ω–Ω—è:</label>
	  <select id="voice" title="–ì–æ–ª–æ—Å –¥–ª—è –æ–∑–≤—É—á–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ" style="display:none;">
		<option value="Ukrainian Female" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
		<option value="Russian Female">–†–æ—Å—ñ–π—Å—å–∫–∞</option>
		<option value="English Female">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</option>
	  </select>
	</div>


  <div id="chat-box" aria-live="polite" aria-label="–Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—É"></div>

  <div id="status"></div>

  <textarea id="user-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å üéôÔ∏è —ñ –≥–æ–≤–æ—Ä—ñ—Ç—å..." rows="3" aria-label="–ü–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"></textarea>

  <div id="controls" style="margin-top: 8px;">
    <button id="btn-send">üì© –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    <button id="btn-voice">üéôÔ∏è –ì–æ–ª–æ—Å–æ–º</button>
    <button id="btn-clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ —á–∞—Ç</button>
    <button id="btn-speak">üîä –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –≥–æ–ª–æ—Å–æ–º</button>
  </div>
  <!-- Telegram –ë–æ—Ç -->
  <div id="telegram-section">
    <h2>ü§ñ Telegram Bot</h2>
    <button id="run-telegram-btn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Telegram –ë–æ—Ç–∞</button>
    <div id="telegram-status"></div>
    üåê <a href="https://t.me/RozumnykSmartBot" target="_blank" class="telegram-link">@RozumnykSmartBot</a>
  </div>

  <script>
    // ‚úÖ –í–°–Ü —Å–∫—Ä–∏–ø—Ç–∏ JS –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –±–µ–∑ –∑–º—ñ–Ω
    // –ü—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –ª–æ–≥—ñ–∫—É –¥–æ –∫–Ω–æ–ø–∫–∏ Telegram
    const runTelegramBtn = document.getElementById("run-telegram-btn");
    runTelegramBtn.addEventListener("click", async () => {
      const telegramStatusDiv = document.getElementById("telegram-status");
      telegramStatusDiv.textContent = "‚è≥ –ó–∞–ø—É—Å–∫ Telegram –ë–æ—Ç–∞...";
      try {
        const response = await fetch("/run_telegram_bot", { method: "POST" });
        const data = await response.json();
        telegramStatusDiv.textContent = response.ok ? data.message : `‚ùå ${data.error}`;
      } catch (err) {
        telegramStatusDiv.textContent = `‚ùå ${err.message}`;
      }
    });

    // –î–∞–ª—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: appendMessage, speak, sendMessage, voice input
    // –¢–∏ –º–æ–∂–µ—à –≤—Å—Ç–∞–≤–∏—Ç–∏ —ó—Ö —ñ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó ‚Äì –≤–æ–Ω–∏ –≤–∂–µ –¥–æ–±—Ä—ñ
  </script>
 <script>
  const chatBox = document.getElementById("chat-box");
  const userInput = document.getElementById("user-input");
  const btnSend = document.getElementById("btn-send");
  const btnVoice = document.getElementById("btn-voice");
  const btnClear = document.getElementById("btn-clear");
  const btnSpeak = document.getElementById("btn-speak");
  const languageSelect = document.getElementById("language");
  const modelSelect = document.getElementById("model");
  const voiceSelect = document.getElementById("voice");
  const statusDiv = document.getElementById("status");

  const API_KEY = "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"; // –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Å–≤—ñ–π –∫–ª—é—á!

  let lastBotResponse = "";
  let recognition = null;
  let recognizing = false;

  // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —á–∞—Ç
  function appendMessage(sender, text) {
    const msgDiv = document.createElement("div");
    msgDiv.className = "message " + (sender === "user" ? "user" : "bot");
    msgDiv.textContent = (sender === "user" ? "üßë: " : "ü§ñ: ") + text;
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Groq API)
  async function sendMessage(text) {
    appendMessage("user", text);
    statusDiv.textContent = "‚è≥ –û—á—ñ–∫—É—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å...";
    btnSend.disabled = true;
    btnVoice.disabled = true;

    const model = modelSelect.value;
    const lang = languageSelect.value;
    const systemPrompt = lang.startsWith("ru") 
      ? "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤." 
      : lang.startsWith("en") 
        ? "You are a helpful assistant. Please respond clearly and concisely, no filler words." 
        : "–¢–∏ –∫–æ—Ä–∏—Å–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —á—ñ—Ç–∫–æ —ñ –∫–æ—Ä–æ—Ç–∫–æ, –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–ª—ñ–≤.";

    const payload = {
      model,
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: text }
      ],
      temperature: 0.3,
      max_tokens: 512
    };

    try {
      const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + API_KEY,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        throw new Error("–ü–æ–º–∏–ª–∫–∞ API: " + res.status);
      }

      const data = await res.json();
      const botText = data.choices?.[0]?.message?.content?.trim() || "‚ö†Ô∏è –ü–æ—Ä–æ–∂–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å";

      appendMessage("bot", botText);
      lastBotResponse = botText;
      statusDiv.textContent = "";

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–∑–≤—É—á–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
      speak(botText, lang);
    } catch (err) {
      appendMessage("bot", "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: " + err.message);
      statusDiv.textContent = "";
    } finally {
      btnSend.disabled = false;
      btnVoice.disabled = false;
    }
  }

  // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ–ª–æ—Å—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–±–æ—Ä—É –º–æ–≤–∏
  function updateVoiceOptions() {
    const lang = languageSelect.value;

    if (lang === "uk-UA") {
      voiceSelect.value = "Ukrainian Female"; // –í–∏–±—ñ—Ä —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –≥–æ–ª–æ—Å—É
    } else if (lang === "ru-RU") {
      voiceSelect.value = "Russian Female"; // –í–∏–±—ñ—Ä —Ä–æ—Å—ñ–π—Å—å–∫–æ–≥–æ –≥–æ–ª–æ—Å—É
    } else if (lang === "en-US") {
      voiceSelect.value = "English Female"; // –í–∏–±—ñ—Ä –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ–≥–æ –≥–æ–ª–æ—Å—É
    }
  }

  // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–±—ñ—Ä –≥–æ–ª–æ—Å—É –ø—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏
  languageSelect.addEventListener("change", updateVoiceOptions);

  // –ü–æ—á–∞—Ç–∫–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ–ª–æ—Å—É
  updateVoiceOptions();

  // –§—É–Ω–∫—Ü—ñ—è –æ–∑–≤—É—á–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
  function speak(text, lang) {
    const voiceMap = {
      "uk-UA": "Ukrainian Female",    // –î–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏
      "ru-RU": "Russian Female",      // –î–ª—è —Ä–æ—Å—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏
      "en-US": "UK English Female"    // –î–ª—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏
    };
    
    const voiceName = voiceMap[lang] || "Ukrainian Female"; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞
    
    if (responsiveVoice.voiceSupport()) {
      responsiveVoice.speak(text, voiceName);  // –û–∑–≤—É—á—É—î —Ç–µ–∫—Å—Ç –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ–π –º–æ–≤—ñ
    }
  }

  // –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏"
  btnSend.addEventListener("click", () => {
    const text = userInput.value.trim();
    if (text) {
      userInput.value = "";
      sendMessage(text);
    }
  });

  // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à—ñ Enter (–±–µ–∑ Shift) –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      btnSend.click();
    }
  });

  // –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç–∏ —á–∞—Ç"
  btnClear.addEventListener("click", () => {
    chatBox.innerHTML = "";
    lastBotResponse = "";
    statusDiv.textContent = "";
  });

  // –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –≥–æ–ª–æ—Å–æ–º"
  btnSpeak.addEventListener("click", () => {
    if (lastBotResponse) {
      speak(lastBotResponse, languageSelect.value);
    }
  });

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è
  btnVoice.addEventListener("click", () => {
    if (!('webkitSpeechRecognition' in window)) {
      alert("–ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.");
      return;
    }

    if (recognizing) {
      recognition.stop();
      return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = languageSelect.value;
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      recognizing = true;
      statusDiv.textContent = "üé§ –ì–æ–≤–æ—Ä—ñ—Ç—å...";
      btnVoice.textContent = "‚ñ† –ó—É–ø–∏–Ω–∏—Ç–∏";
      btnSend.disabled = true;
    };

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      userInput.value = transcript;
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—ñ—Å–ª—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
      recognition.stop();
      sendMessage(transcript);
    };

    recognition.onerror = (event) => {
      alert("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –≥–æ–ª–æ—Å—É: " + event.error);
      recognizing = false;
      btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
      btnSend.disabled = false;
      statusDiv.textContent = "";
    };

    recognition.onend = () => {
      recognizing = false;
      btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
      btnSend.disabled = false;
      if (!userInput.value) {
        statusDiv.textContent = "";
      }
    };

    recognition.start();
  });

</script>

</body>
</html>
